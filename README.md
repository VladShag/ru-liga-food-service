<h1>Сервис по доставке еды. Общая структура.</h1>
Общая структура сервиса по доставке еды состоит из 9 модулей:
<br>

- Dependency Bom
<br>
- Common
<br>
- Migration
<br>
- Security Service
<br>
- Order Service
<br>
- Kitchen Service
<br>
- Delivery Service
<br>
- Cloud Gateway
<br>
- Notification Service
<h3>Использованные технологии:</h3>

- Java 11 
<br>
- Spring Boot
<br>
- Spring Data JPA
<br>
- Spring Security
<br>
- Spring Web
<br>
- LiquiBase
<br>
- PostgreSQL
<br>
- MyBatis
<br>
- Lombok
<br>
- RabbitMQ
<br>
- Feign
<br>
- Swagger
<br>
- Slf4j + Log4j
<br>
- JUnit 


<h2>Dependency Bom</h2>
В dependency модуле указаны все зависимости, которые используются в проекте и остальных модулях, а также их актуальные версии.
<br>
Все зависимости храняться в <b>pom.xml</b>
<br>
<h2>Common</h2>
В модуле Common находятся сущности, которые используются во всех Rest модулях, а также репозитории, через которые идет обращение к БД и кастомная ошибка <b>NoSuchEntityException</b>
которая используется для проверки наличия сущности при обращении к бд.
<h2>Migration</h2>
Модуль Migration взаимодействует с Базой данный с помощью <b>LiquidBase.</b>
<br>
Модуль создает базовые таблицы в БД, необходимые для работы всего проекта, а также отдельную схему <b>auth</b> в которой находятся таблицы необходимые для обеспечения авторизации и аутентификации пользователей.
<h2>Security Service</h2>
Данный модуль отвечает за регистрацию, авторизацию и аутентификацию пользователей. 
<br>
Каждый Rest service проекта(Delivery, Kitchen и Order services) для аутентификации перенаправляет запрос на <b>Localhost:9000</b> на котором и находится Security Service, который и ощуествляет OAuth2 аутентификацию.
<h2>Order Service</h2>
Сервис заказов спроектирован для работы с клиентской стороной. В сервисе предоставлено 3 контроллера: OrderRestController, OrderItemRestController и CustomerController. 
<br> 
Вся документация по работе с Order-service доступна в swagger'e.
<br>
При оплате клиентом заказа (т.е. выставления статуса <b>CUSTOMER_PAID</b>)
Сервис отправляет запрос через RabbitMQ на <b>Notification Service</b> который перенаправляет сообщение с id заказа на сервис ресторана(<b>Kitchen Service</b>)
<h2>Kitchen Service</h2>
Сервис ресторана содержит в себе 3 контроллера и, соответственно, сервиса-
<br>
<b>OrderController</b> для работы с заказами
<br>
<b>RestaurantRestController</b> для занесения, изменение и получения информации о ресторанах, присутствующих в базе данных
<br>
<b>RestaurantMenuItemRestController</b> для управления и редактирования меню ресторанов.
<br> 
При работе с заказами, если ресторан принял заказ и приготовил его (изменил статус заказа на <b>DELIVERY_PENDING</b>
Идет отправка асинхронного сообщения через <b>RabbitMQ</b> через <b>Notification Service</b> на сервис курьеров(<b>Delivery Service</b>) с ДТО, содержащей id заказа и координаты ресторана.
<br>
При отказе от заказа (выставления статуса <b>KITCHEN_DENIED</b>) отправляется уведомление на сервис заказов с оповещением, что ресторана отказался от заказа.
<h2>Delivery Service</h2>
Сервис курьеров предоставляет доступ к контроллеру доставок (<b>DeliveryRestController</b>)
а также контроллер и сервис для создания/изменения/удаления курьеров из БД(<b>CourierController</b>) 
При получении запроса из <b>Kitchen Service</b> Происходит mapping DTO содержащего информацию о заказе и на основании координат выбирается ближайший активный курьер который и назначается на доставку. <br>
<a>Метод не доделан чисто математичеки, в данный момент лишь пытается найти курьера координаты которого полностью совпадают с координатами ресторана</a>
<br>
При попытке установить статус заказа идет обращение через <b>Feign</b> к сервису заказов и соответвтующему методу(сделан для демонстрации полученных знаний)
<h2>Cloud Gateway</h2>
Данный модуль перенаправляет запросу к общему порту <b>http://127.0.0.1:8080</b>
на необходимый сервис по его порту. 
<br>
Вся информация о настройка Gateway прописана в <b>application.yml</b>
<h2>Notification Service</h2>
Является информационным сервисом, в котором реализовано 3 <b>Queue Listener'a</b> и 3 очереди для перенаправления асинхронных обращений на нужный сервис. 